# CRF_QC_MVP

This repository contains a lightweight workflow for quality-controlling case report form (CRF) digitization. It mirrors the structure used in the internal prototype so that teams can reproduce the pipeline locally.

## Repository layout

```
.
├── data/
│   ├── scans/          # Source PDFs or rendered page images of CRFs
│   ├── drafts/         # HTML drafts generated by the extraction pipeline
│   └── qc_output/      # Intermediate JSON/CSV artifacts produced during QC
├── label_studio/
│   ├── template_crf.xml        # Label Studio interface configuration
│   └── sample_import.jsonl     # Example tasks to bootstrap the project
├── output/
│   └── crf_final.xlsx          # Final aggregated QC export (placeholder)
├── scripts/
│   ├── run_labelstudio.sh      # Helper to start Label Studio with the CRF project
│   ├── make_labelstudio_tasks.py   # Build JSONL tasks from scans + drafts
│   ├── json_to_excel.py            # Convert Label Studio export into Excel
│   ├── ocr_pdf_to_images.py        # Optional PDF-to-image helper
│   └── ocr_image_to_text.py        # Optional OCR helper
├── requirements.txt
└── README.md
```

## Getting started

1. **Install dependencies**
   ```bash
   python -m venv .venv
   source .venv/bin/activate
   pip install -r requirements.txt
   ```

2. **Prepare source materials**
   * Place page-level CRF scans (PNG or JPG) in `data/scans/`. If your source is a PDF, use `scripts/ocr_pdf_to_images.py` to render images.
   * Drop the HTML drafts generated by your extraction pipeline into `data/drafts/`. Each file should be named to match the corresponding scan (e.g. `subject001_page_01.html`).

3. **Generate Label Studio tasks**
   ```bash
   python scripts/make_labelstudio_tasks.py label_studio/import.jsonl
   ```
   The command pairs images with drafts and produces a JSONL file ready for import. Use `--checklist path/to/items.txt` to override the default QC checklist.

4. **Launch Label Studio**
   ```bash
   ./scripts/run_labelstudio.sh
   ```
   The script enables local file serving, points Label Studio at the CRF interface defined in `label_studio/template_crf.xml`, and seeds the project with `label_studio/sample_import.jsonl` (or the JSONL you generated in the previous step). Sign in at http://localhost:8080 to begin reviewing.

5. **Perform QC review**
   * Compare the scan with the draft rendered in the right-hand panel.
   * Work through the checklist and record discrepancies in the notes field.
   * Set the overall QC status using the choices provided.

6. **Export results**
   * From Label Studio, export the completed tasks as JSON or JSONL.
   * Convert the export into Excel with:
     ```bash
     python scripts/json_to_excel.py path/to/export.json output/crf_final.xlsx
     ```
   * The resulting workbook collates reviewer decisions, comments, and metadata. Share it with the downstream reconciliation team.

## Optional OCR helpers

* `ocr_pdf_to_images.py` renders PDF scans into PNG images suitable for review and downstream OCR.
* `ocr_image_to_text.py` runs Tesseract OCR across a batch of images and stores raw text output in `data/qc_output/` for quick inspection or diffing against draft content.

These utilities are not required for the QC workflow but replicate convenience scripts from the original prototype.
